# PWL 波形编辑器用户手册

本应用程序是一个现代化的 PWL (Piecewise Linear) 波形编辑器，专为电子仿真（如 Cadence Virtuoso）设计。它支持实时波形预览、拖拽编辑、工程计数法输入以及与仿真软件兼容的 PWL 文本生成。

## 1. 安装与运行

### 1.1 系统要求
- 操作系统：Windows / macOS / Linux
- Python 版本：3.x

### 1.2 安装依赖
在运行程序之前，请确保已安装必要的 Python 库：
```bash
pip install customtkinter matplotlib pyperclip
```

### 1.3 运行程序
在终端中运行以下命令启动编辑器：
```bash
python pwl_editor.py
```

---

## 2. 界面概览

程序界面主要分为上下两个部分，中间由一个可拖动的分割条隔开。顶部设有菜单栏用于文件和波形操作。

### 2.1 顶部菜单栏
- **文件(F)**：
    - **保存波形(S)**：将当前编辑的波形数据保存为 `.json` 文件。
    - **载入波形(L)**：从 `.json` 文件读取波形数据。
    - **退出(X)**：关闭程序。
- **波形(W)**：
    - **生成正弦波...**：打开快速生成正弦波的工具。
    - **生成方波...**：打开快速生成方波的工具。
    - **生成三角波...**：打开快速生成三角波的工具。
- **关于(A)**：
    - **快捷键列表**：查看所有可用快捷键。
    - **关于本项目**：显示版本和项目信息。

### 2.2 主界面区域
1.  **波形显示区 (上部)**：
    -   实时显示 PWL 波形。
    -   **蓝色实线**：表示波形路径。
    -   **蓝色圆点**：表示定义的波形点。
    -   **黄色高亮点**：表示当前选中的点。
    -   **垂直引导线**：从 Y 轴 (Time=0) 延伸到第一个波形点的辅助线，表示初始电平。

2.  **操作控制区 (下部)**：
    -   **左侧：数据点列表**。表格形式显示所有点的 `Time` 和 `Value`。支持直接双击编辑。
    -   **中间：工具栏**。包含添加点、删除点、生成示例、Y 轴范围设置等功能按钮。
    -   **右侧：PWL 文本输出**。实时生成的 PWL 文本，可直接复制。

> **提示**：您可以拖动中间的水平分割条，自由调整波形区域和操作面板的高度比例。

---

## 3. 快速波形生成器

点击菜单栏的 **波形** 选项，可以选择生成标准波形。

### 3.1 界面布局
波形生成器采用左右分栏布局：
- **左侧：参数设置**。可以设置频率、幅度、偏移、时长等参数。支持工程计数法（如 `1k`, `500u`）。
- **右侧：单周期预览**。实时显示当前参数下的波形形状（单周期或局部），方便快速确认参数效果。

### 3.2 支持的波形类型
- **正弦波**：支持设置每周期点数（点数越多越平滑，但数据量越大）。
- **方波**：
    - 支持设置 **占空比**。
    - 支持独立设置 **上升时间 (tr)** 和 **下降时间 (tf)**。
- **三角波**：
    - 支持设置 **上升占比 (%)**。
    - 默认为 50%（标准三角波）。
    - 设置为 0% 或 100% 可生成 **锯齿波**。

设置完成后，点击底部的 **生成波形** 按钮，新生成的波形将替换当前编辑器中的所有内容。

---

## 4. 基本操作

### 4.1 添加波形点
有多种方式可以添加点：
*   **手动输入**：在工具栏的 "Time" 和 "Value" 输入框中输入数值，点击 `添加点`。
    *   支持 **工程计数法**（例如：`1m` = 0.001, `1u` = 1e-6, `1k` = 1000）。
*   **快捷键添加**：将鼠标移动到波形图上的任意位置，按下键盘 **`M`** 键，即可在当前鼠标位置快速插入一个点。
*   **快速追加**：点击 `快速添加点` 按钮，会在最后一个点的时间基础上增加 1ms (1m)，值保持不变。

### 4.2 选择点
*   **单击**：点击波形上的圆点进行单选。
*   **多选**：
    *   按住 `Ctrl` 键单击多个点。
    *   按住 `Shift` 键单击两个点，选择它们之间的所有点。
*   **框选**：在波形图空白处 **按住鼠标左键拖动**，绘制一个矩形框，框内的所有点将被选中。

### 4.3 移动/编辑点
*   **鼠标拖拽**：
    *   选中一个或多个点后，**按住鼠标左键拖动** 即可移动点。
    *   **多点拖动**：如果选中了多个点，拖动其中一个，其他点会跟随移动，保持相对位置不变。
    *   **限制**：第一个点的时间被锁定为 ≥ 0。后续点的时间不能小于前一个点（会自动排序，但建议保持逻辑顺序）。
*   **表格编辑**：
    *   双击下方列表中的 `Time` 或 `Value` 单元格，直接输入新数值并回车。同样支持工程计数法（如 `500u`）。

### 4.4 删除点
*   选中一个或多个点后，点击工具栏的 `删除选中点` 按钮。
*   或者直接按下键盘 **`Delete`** 键。
*   点击 `清除所有点` 可清空画布。

---

## 5. 视图控制与导航

### 5.1 缩放 (Zoom)
*   **滚轮缩放**：滚动鼠标滚轮。
    *   **向上滚动**：放大视图。
    *   **向下滚动**：缩小视图。
    *   缩放以鼠标指针所在位置为中心。
    *   缩放操作会自动同步更新工具栏中的手动 Y 轴范围设置。
*   **框选放大**：在波形图上 **按住鼠标右键拖动**，绘制一个矩形框，释放后视图将自动缩放到该区域。
*   **自动全屏**：点击工具栏的 `Zoom All` 按钮（或快捷键 **`F`**），视图将自动调整以显示所有波形点（包括从 Time=0 开始的区域）。

### 5.2 平移 (Pan)
*   **中键拖动**：**按住鼠标中键（滚轮）拖动**，可以像抓手一样平移波形视图（类似 Virtuoso Waveview 操作习惯）。

---

## 6. 高级功能与细节

### 6.1 工程计数法支持
所有输入框（添加点、Y 轴范围、表格编辑）均支持标准工程后缀：
*   `f` = 1e-15
*   `p` = 1e-12
*   `n` = 1e-9
*   `u` = 1e-6
*   `m` = 1e-3
*   `k` = 1e3
*   `M` = 1e6
*   `G` = 1e9

### 6.2 拖动精度
*   默认拖动精度设置为 **1m** (1e-3)。这意味着拖动点时，数值会吸附到最接近的 1ms 网格上，方便对齐。
*   您可以在工具栏的下拉菜单中修改此精度（如 `1u`, `0.1` 等）。

### 6.3 PWL 输出与导出
*   右下角的文本框会实时显示符合 Virtuoso 格式的 PWL 描述。
*   点击 `复制PWL` 按钮一键复制到剪贴板。
*   点击 `保存PWL` 按钮导出为 `.txt` 文件。

### 6.4 视觉风格
*   采用 **VS Code Dark Theme** 风格，深色背景，护眼且专业。
*   支持 Windows 系统 **高 DPI 缩放**，在高分屏上显示清晰锐利。

---

## 7. 快捷键列表

| 按键 | 功能 |
| :--- | :--- |
| **M** | 在鼠标指针处添加新点 (Make Point) |
| **Delete** | 删除当前选中的点 |
| **F** | 缩放至全部显示 (Fit All) |
| **鼠标左键拖动** | (空白处) 框选点；(点上) 移动点 |
| **鼠标右键拖动** | 框选放大视图区域 |
| **鼠标中键拖动** | 平移视图 |
| **Ctrl + Click** | 多选/反选点 |
| **Shift + Click** | 范围选择点 |
| **滚轮** | 以指针为中心放大/缩小 |
